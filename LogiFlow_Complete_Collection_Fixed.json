{
	"info": {
		"_postman_id": "e8b6a9c2-4567-8910-abcd-123456789abc",
		"name": "LogiFlow Microservices - Complete Collection V2",
		"description": "Colecci√≥n completa y corregida de APIs para todos los microservicios de LogiFlow\n\nüîê **Autenticaci√≥n JWT Requerida**\n- Login primero para obtener ACCESS_TOKEN\n- El token se guarda autom√°ticamente para otros requests\n\nüåê **Servicios y rutas correctas:**\n- Auth Service (8081): /api/auth/*\n- Pedido Service (8084): /api/pedidos/*\n- Billing Service (8082): /api/facturas/*, /api/tarifas/*\n- Fleet Service (8083): /api/repartidores/*, /api/vehiculos/*, /api/health\n- Kong Gateway (8080): Rutas a todos los servicios",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "üîê Auth Service",
			"item": [
				{
					"name": "Login User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has access token\", function () {",
									"    const response = pm.response.json();",
									"    pm.expect(response).to.have.property('accessToken');",
									"});",
									"",
									"// Guardar tokens autom√°ticamente",
									"const response = pm.response.json();",
									"if (response.accessToken) {",
									"    pm.environment.set(\"ACCESS_TOKEN\", response.accessToken);",
									"    console.log(\"‚úÖ ACCESS_TOKEN guardado exitosamente\");",
									"}",
									"if (response.refreshToken) {",
									"    pm.environment.set(\"REFRESH_TOKEN\", response.refreshToken);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
						},
						"url": {
							"raw": "{{AUTH_URL}}/api/auth/login",
							"host": ["{{AUTH_URL}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Register User",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"admin\",\n  \"email\": \"admin@logiflow.com\",\n  \"password\": \"admin123\",\n  \"roles\": [\"ADMINISTRADOR_SISTEMA\"]\n}"
						},
						"url": {
							"raw": "{{AUTH_URL}}/api/auth/register",
							"host": ["{{AUTH_URL}}"],
							"path": ["api", "auth", "register"]
						}
					}
				},
				{
					"name": "Get Protected Me",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{AUTH_URL}}/api/protected/me",
							"host": ["{{AUTH_URL}}"],
							"path": ["api", "protected", "me"]
						}
					}
				}
			]
		},
		{
			"name": "üì¶ Pedido Service",
			"item": [
				{
					"name": "Create Pedido",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.id) {",
									"        pm.environment.set(\"PEDIDO_ID\", response.id);",
									"        console.log(\"PEDIDO_ID guardado:\", response.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"clienteId\": \"CLIENTE-001\",\n  \"modalidadServicio\": \"URBANA_RAPIDA\",\n  \"tipoEntrega\": \"DOCUMENTO\",\n  \"peso\": 0.5,\n  \"prioridad\": \"NORMAL\",\n  \"direccionOrigen\": {\n    \"calle\": \"Av. Amazonas 123\",\n    \"ciudad\": \"Quito\",\n    \"provincia\": \"Pichincha\",\n    \"codigoPostal\": \"170501\",\n    \"referencia\": \"Frente al parque\"\n  },\n  \"direccionDestino\": {\n    \"calle\": \"Calle Venezuela 456\",\n    \"ciudad\": \"Quito\",\n    \"provincia\": \"Pichincha\",\n    \"codigoPostal\": \"170502\",\n    \"referencia\": \"Edificio azul, segundo piso\"\n  },\n  \"descripcionContenido\": \"Documentos legales importantes\",\n  \"valorDeclarado\": 100.00\n}"
						},
						"url": {
							"raw": "{{PEDIDO_URL}}/api/pedidos",
							"host": ["{{PEDIDO_URL}}"],
							"path": ["api", "pedidos"]
						}
					}
				},
				{
					"name": "Get All Pedidos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{PEDIDO_URL}}/api/pedidos",
							"host": ["{{PEDIDO_URL}}"],
							"path": ["api", "pedidos"]
						}
					}
				},
				{
					"name": "Get Pedido by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{PEDIDO_URL}}/api/pedidos/{{PEDIDO_ID}}",
							"host": ["{{PEDIDO_URL}}"],
							"path": ["api", "pedidos", "{{PEDIDO_ID}}"]
						}
					}
				},
				{
					"name": "Get Pedidos Pendientes",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{PEDIDO_URL}}/api/pedidos/pendientes-asignacion",
							"host": ["{{PEDIDO_URL}}"],
							"path": ["api", "pedidos", "pendientes-asignacion"]
						}
					}
				},
				{
					"name": "Cancel Pedido",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{PEDIDO_URL}}/api/pedidos/{{PEDIDO_ID}}/cancelar",
							"host": ["{{PEDIDO_URL}}"],
							"path": ["api", "pedidos", "{{PEDIDO_ID}}", "cancelar"]
						}
					}
				}
			]
		},
		{
			"name": "üí∞ Billing Service",
			"item": [
				{
					"name": "Create Factura",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.id) {",
									"        pm.environment.set(\"FACTURA_ID\", response.id);",
									"        console.log(\"FACTURA_ID guardado:\", response.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"pedidoId\": \"{{PEDIDO_ID}}\",\n  \"tipoEntrega\": \"DOCUMENTO\",\n  \"peso\": 0.5,\n  \"distanciaKm\": 5.2,\n  \"valorDeclarado\": 100.00\n}"
						},
						"url": {
							"raw": "{{BILLING_URL}}/api/facturas",
							"host": ["{{BILLING_URL}}"],
							"path": ["api", "facturas"]
						}
					}
				},
				{
					"name": "Get Factura by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{BILLING_URL}}/api/facturas/{{FACTURA_ID}}",
							"host": ["{{BILLING_URL}}"],
							"path": ["api", "facturas", "{{FACTURA_ID}}"]
						}
					}
				},
				{
					"name": "Get All Tarifas",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{BILLING_URL}}/api/tarifas/tarifas",
							"host": ["{{BILLING_URL}}"],
							"path": ["api", "tarifas", "tarifas"]
						}
					}
				},
				{
					"name": "Create Tarifa",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"tipoEntrega\": \"DOCUMENTO\",\n  \"tarifaBase\": 5.00,\n  \"tarifaPorKg\": 2.50,\n  \"tarifaPorKm\": 0.80\n}"
						},
						"url": {
							"raw": "{{BILLING_URL}}/api/tarifas",
							"host": ["{{BILLING_URL}}"],
							"path": ["api", "tarifas"]
						}
					}
				}
			]
		},
		{
			"name": "üöö Fleet Service",
			"item": [
				{
					"name": "Get All Repartidores",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{FLEET_URL}}/api/repartidores",
							"host": ["{{FLEET_URL}}"],
							"path": ["api", "repartidores"]
						}
					}
				},
				{
					"name": "Create Repartidor",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.id) {",
									"        pm.environment.set(\"REPARTIDOR_ID\", response.id);",
									"        console.log(\"REPARTIDOR_ID guardado:\", response.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"cedula\": \"1234567890\",\n  \"nombreCompleto\": \"Juan P√©rez Repartidor\",\n  \"email\": \"juan.perez@logiflow.com\",\n  \"telefono\": \"+593987654321\",\n  \"licencia\": {\n    \"numero\": \"LIC123456789\",\n    \"categoria\": \"B\",\n    \"fechaVencimiento\": \"2026-12-31\"\n  },\n  \"tipoRepartidor\": \"REPARTIDOR_MOTORIZADO\"\n}"
						},
						"url": {
							"raw": "{{FLEET_URL}}/api/repartidores",
							"host": ["{{FLEET_URL}}"],
							"path": ["api", "repartidores"]
						}
					}
				},
				{
					"name": "Get All Vehiculos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{FLEET_URL}}/api/vehiculos",
							"host": ["{{FLEET_URL}}"],
							"path": ["api", "vehiculos"]
						}
					}
				},
				{
					"name": "Create Vehiculo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.id) {",
									"        pm.environment.set(\"VEHICULO_ID\", response.id);",
									"        console.log(\"VEHICULO_ID guardado:\", response.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"placa\": \"ABC-1234\",\n  \"marca\": \"Honda\",\n  \"modelo\": \"CBR150\",\n  \"anio\": 2023,\n  \"tipoVehiculo\": \"MOTOCICLETA\",\n  \"capacidadCarga\": 15.0,\n  \"color\": \"Rojo\"\n}"
						},
						"url": {
							"raw": "{{FLEET_URL}}/api/vehiculos",
							"host": ["{{FLEET_URL}}"],
							"path": ["api", "vehiculos"]
						}
					}
				},
				{
					"name": "Fleet Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{FLEET_URL}}/api/health",
							"host": ["{{FLEET_URL}}"],
							"path": ["api", "health"]
						}
					}
				}
			]
		},
		{
			"name": "üåê Kong Gateway Tests",
			"item": [
				{
					"name": "Auth via Kong - Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.accessToken) {",
									"        pm.environment.set(\"ACCESS_TOKEN\", response.accessToken);",
									"        console.log(\"‚úÖ ACCESS_TOKEN via Kong guardado\");",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
						},
						"url": {
							"raw": "{{KONG_URL}}/api/auth/login",
							"host": ["{{KONG_URL}}"],
							"path": ["api", "auth", "login"]
						}
					}
				},
				{
					"name": "Pedidos via Kong",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{KONG_URL}}/api/pedidos",
							"host": ["{{KONG_URL}}"],
							"path": ["api", "pedidos"]
						}
					}
				},
				{
					"name": "Fleet via Kong - Repartidores",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{KONG_URL}}/api/repartidores",
							"host": ["{{KONG_URL}}"],
							"path": ["api", "repartidores"]
						}
					}
				},
				{
					"name": "Fleet via Kong - Vehiculos",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{KONG_URL}}/api/vehiculos",
							"host": ["{{KONG_URL}}"],
							"path": ["api", "vehiculos"]
						}
					}
				},
				{
					"name": "Billing via Kong - Tarifas",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{ACCESS_TOKEN}}"
							}
						],
						"url": {
							"raw": "{{KONG_URL}}/api/tarifas/tarifas",
							"host": ["{{KONG_URL}}"],
							"path": ["api", "tarifas", "tarifas"]
						}
					}
				}
			]
		},
		{
			"name": "üîß Health Checks",
			"item": [
				{
					"name": "Auth Service Health",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{AUTH_URL}}/actuator/health",
							"host": ["{{AUTH_URL}}"],
							"path": ["actuator", "health"]
						}
					}
				},
				{
					"name": "Pedido Service Health",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{PEDIDO_URL}}/actuator/health",
							"host": ["{{PEDIDO_URL}}"],
							"path": ["actuator", "health"]
						}
					}
				},
				{
					"name": "Fleet Service Health",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{FLEET_URL}}/api/health",
							"host": ["{{FLEET_URL}}"],
							"path": ["api", "health"]
						}
					}
				},
				{
					"name": "Billing Service Health",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BILLING_URL}}/actuator/health",
							"host": ["{{BILLING_URL}}"],
							"path": ["actuator", "health"]
						}
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "ACCESS_TOKEN",
			"value": "",
			"type": "string"
		},
		{
			"key": "PEDIDO_ID",
			"value": "",
			"type": "string"
		},
		{
			"key": "REPARTIDOR_ID",
			"value": "",
			"type": "string"
		},
		{
			"key": "VEHICULO_ID",
			"value": "",
			"type": "string"
		},
		{
			"key": "FACTURA_ID",
			"value": "",
			"type": "string"
		}
	]
}

