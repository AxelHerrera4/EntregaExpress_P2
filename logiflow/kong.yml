_format_version: "3.0"

services:
  # Auth Service
  - name: authservice
    url: http://authservice:8081
    routes:
      - name: auth-api-route
        paths:
          - /api/auth
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
      - name: auth-protected-route
        paths:
          - /api/protected
        strip_path: false
        methods:
          - GET
          - POST

  # Billing Service
  - name: billing-service
    url: http://billing-service:8082
    routes:
      - name: billing-facturas-route
        paths:
          - /api/facturas
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
      - name: billing-tarifas-route
        paths:
          - /api/tarifas
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH

  # Fleet Service
  - name: fleet-service
    url: http://fleet-service:8083
    routes:
      - name: fleet-repartidores-route
        paths:
          - /api/repartidores
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
      - name: fleet-vehiculos-route
        paths:
          - /api/vehiculos
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
      - name: fleet-asignaciones-route
        paths:
          - /api/asignaciones
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
      - name: fleet-health-route
        paths:
          - /api/health
        strip_path: false
        methods:
          - GET

  # Pedido Service
  - name: pedido-service
    url: http://pedido-service:8084
    routes:
      - name: pedido-api-route
        paths:
          - /api/pedidos
        strip_path: false
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH

# Plugin global para logging y JWT
plugins:
  - name: correlation-id
    config:
      header_name: X-Correlation-ID
      generator: uuid
      echo_downstream: true

  - name: request-transformer
    config:
      add:
        headers:
          - X-Gateway:Kong
          - X-Forwarded-Proto:http

# Plugin JWT global (opcional - los servicios ya manejan JWT internamente)
# consumers:
#   - username: jwt-consumer
#     jwt_secrets:
#       - key: VGhpcy1pcy1hLXNlY3JldC1rZXktZm9y-LWRlbW8tYXBwLWp3dC0yMDI1
#         algorithm: HS256
